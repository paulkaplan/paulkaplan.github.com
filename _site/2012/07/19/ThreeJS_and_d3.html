<!DOCTYPE html>
<html>
  <head>
    <title>d3.js &#58; A Short Primer</title>
    <meta charset="utf-8" />
    <meta name="description" content="Personal website for Paul Kaplan" />
    <meta name="keywords" content="Paul,Kaplan,UChicago,University of Chicago, personal, interfaces" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />/
    <!--[if lte IE 9]><link rel="stylesheet" href="css/ie.css" type="text/css" media="screen" /><![endif]-->
    <link href="//fonts.googleapis.com/css?family=Open+Sans:400,300,600|Merriweather:400,300,700" rel="stylesheet" type="text/css">
    <link rel="stylesheet" href="/css/1140.css" type="text/css" media="screen" />
    <link rel="stylesheet" href="/css/styles.css" type="text/css"
     media="screen"/>
    <link rel="stylesheet" href="/css/syntax.css" type="text/css" media="screen"/>
  </head>
  <body>
    <div class="container">
      <div class="row header">
        <div class="twelvecol last">
          <h1><span class="big">Paul Kaplan</span></h1>
            <h3><span class="bffig">experimentalist programming</span></h2>
          </div>
        </div>
      </div>
      <div class="row content">
        <p><a href="LINK" title="d3.js">d3.js</a> is a great javascript library for representing and manipulating all sorts of data. It is not an simply an SVG API in the way that <a href="LINK" title="raphael.js">Raphael.js</a> is although it does make working with SVG objects considerably easier and the defaults make everything look very pretty. But d3 is more, it is about "Data Driven Documents", as they put it; it provides both the tools and conceptual model to deal with changing data. The data is not limited to population graphs and stock prices. The d3 model can be used for any type of array of things which needs to be mapped onto other things. The most obvious use of this is visually representing arrays of numbers by mapping them to SVG objects. Of course, they could also be mapped onto arrays of DOM elements of any sort, including the plain old <code>&lt;div&gt;</code>.</p>

<h3>Working with data in d3</h3>

<p>This is covered at length elsewhere, most notably <a href="LINK%20TO%203CIRCLES" title="three litte circles">here</a> so I wont go to far here. Remember, d3 is all about mapping arrays onto 'physical' objects (DOM elements, SVG elements, etc). What is different about d3 is that it focuses on the <strong>coming and going</strong> of data which is just as important if not more important than the initial mapping. The concept of <strong>actors</strong> 'entering' and 'exiting' the stage is a useful metaphor here. We start (always) with the array of things to be mapped over (not the data), usually with <code>d3.selectAll('somethings')</code>. Next we map the data over it with</p>

<div class="highlight"><pre><code class="js"><span class="kd">var</span> <span class="nx">dataMap</span> <span class="o">=</span> <span class="nx">d3</span><span class="p">.</span><span class="nx">selectAll</span><span class="p">(</span><span class="s1">&#39;somethings&#39;</span><span class="p">).</span><span class="nx">data</span><span class="p">(</span> <span class="nx">ourData</span> <span class="p">)</span>
</code></pre>
</div>


<p>There are a few possibilities here: either the data outnumber the list of objects you are mapping them onto (say if you where first initializing it, and there where 0 elements and all the data points), you could be perfectly lined up in terms of data and representative elements, or you could have too many objects for the number of data points you have. The pattern usually looks like this</p>

<p>First add more objects if you have to many data points</p>

<div class="highlight"><pre><code class="js"><span class="nx">d3</span><span class="p">.</span><span class="nx">selectAll</span><span class="p">(</span><span class="s1">&#39;circle&#39;</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">data</span><span class="p">(</span> <span class="nx">ourData</span> <span class="p">).</span><span class="nx">append</span><span class="p">(</span><span class="s1">&#39;circle&#39;</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">attr</span><span class="p">(...)</span>
</code></pre>
</div>


<p><img src="/img/20120720/d3_enter.JPG" title=".enter() drawing" alt=".enter()" /></p>

<p>Then remove any left over objects if you have more than you have data</p>

<div class="highlight"><pre><code class="js">  <span class="nx">d3</span><span class="p">.</span><span class="nx">selectAll</span><span class="p">(</span><span class="s1">&#39;circle&#39;</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">data</span><span class="p">(</span> <span class="nx">ourData</span> <span class="p">)</span>
      <span class="p">.</span><span class="nx">remove</span><span class="p">()</span>
  
</code></pre>
</div>


<p><img src="/img/20120720/d3_exit.JPG" title=".enter() drawing" alt=".enter()" /></p>

<h4>Using the data</h4>

<p>Once we actually get to using the data, it is relatively simple with d3's very extensive SVG API</p>

<div class="highlight"><pre><code class="js"><span class="c1">// The standard d3 examples include things like creating the svg canvas</span>
<span class="kd">var</span> <span class="nx">svg</span> <span class="o">=</span> <span class="nx">d3</span><span class="p">.</span><span class="nx">select</span><span class="p">(</span><span class="s1">&#39;html&#39;</span><span class="p">).</span><span class="nx">append</span><span class="p">(</span><span class="s1">&#39;svg&#39;</span><span class="p">)</span>
<span class="c1">// creating some data</span>
<span class="kd">var</span> <span class="nx">data</span> <span class="o">=</span> <span class="nx">d3</span><span class="p">.</span><span class="nx">range</span><span class="p">(</span><span class="mi">100</span><span class="p">).</span><span class="nx">map</span><span class="p">(</span> <span class="kd">function</span><span class="p">(){</span> <span class="c1">// Note the convenient range() function similar to python</span>
  <span class="k">return</span> <span class="p">[</span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span><span class="o">*</span><span class="mi">100</span><span class="p">,</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span><span class="o">*</span><span class="mi">100</span><span class="p">];</span>
<span class="p">});</span>
<span class="c1">// and creating some elements, setting their attributes</span>
<span class="nx">svg</span><span class="p">.</span><span class="nx">selectAll</span><span class="p">(</span><span class="s1">&#39;circle&#39;</span><span class="p">)</span> <span class="c1">// Remember it is ok that none of them exist yet</span>
  <span class="p">.</span><span class="nx">data</span><span class="p">(</span> <span class="nx">data</span> <span class="p">).</span><span class="nx">enter</span><span class="p">()</span> <span class="c1">// We know all the data will end up here, </span>
                        <span class="c1">// since there are no circles yet</span>
  <span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s1">&#39;circle&#39;</span><span class="p">)</span> <span class="c1">// So we create one for each data point</span>
    <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">d</span><span class="p">){</span> <span class="k">return</span> <span class="nx">d</span><span class="p">.</span><span class="nx">x</span><span class="p">})</span> 
<span class="c1">// Unless an attribute will be the same for every element,</span>
<span class="c1">//    it must be filled with a function to be called on each point.</span>
<span class="c1">// Also, d3 alias&#39; arrays with 2 values [x,y] to have </span>
<span class="c1">//    d.x and d.y available by default. </span>
    <span class="p">.</span><span class="nx">transition</span><span class="p">()</span>
      <span class="p">.</span><span class="nx">duration</span><span class="p">(</span><span class="mi">1000</span><span class="p">)</span> <span class="c1">//milliseconds</span>
      <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="c1">// shrink to radius 0 over the given duration</span>
      
</code></pre>
</div>


<p><img src="/img/20120720/d3_data.JPG" title=".enter() drawing" alt=".enter()" /></p>

      </div>
    </div>
    <script src="/js/head.js" type="text/javascript"></script>
    <script type="text/javascript">
      head.js(
        { jquery   :   '/js/jquery.js' },
        { paul     :   '/js/paul.js'   }
        // 
        // 
        //   
        //     ,{ d3 : '/js/d3.js' }
        //   
        //     ,{ three : '/js/three.js' }
        //   
        //     ,{ example : '/js/example.js' }
        //   
        // 
        //   
        // 
        //   
        // 
      );
    </script>
    <script src="/js/mediaqueries.js" type="text/javascript"></script>
  </body>
</html>